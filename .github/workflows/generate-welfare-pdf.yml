name: Generate Welfare PDF

on:
  workflow_dispatch:

jobs:
  build-pdf:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install reportlab

      - name: Generate PDF
        run: |
          python << 'EOF'
          from reportlab.platypus import SimpleDocTemplate, Table, TableStyle, Paragraph, Spacer
          from reportlab.lib.pagesizes import A4
          from reportlab.lib import colors
          from reportlab.lib.styles import getSampleStyleSheet

          items = [
              ["Pain Relief Spray", "Pain relief for emergencies", 2, 3000],
              ["Paracetamol", "Pain & fever relief", 1, 2500],
              ["Pure Water", "For drinking", 1, 8000],
              ["Glucose", "Energy boost", 2, 500],
              ["Plaster", "First aid plaster", 2, 3500],
              ["Cotton Bud", "For cleaning", 4, 200],
              ["Methylated Spirit", "Antiseptic cleaning", 1, 3000],
              ["Bandages", "Wound dressing", 4, 500],
              ["Cotton Wool", "For medical cleaning", 2, 1000],
          ]

          rows = []
          total_cost = 0

          for name, description, qty, unit_cost in items:
              estimated = qty * unit_cost
              total_cost += estimated
              rows.append([
                  name,
                  description,
                  str(qty),
                  str(unit_cost),
                  str(estimated)
              ])

          rows.append([
              "Outstanding",
              "Money to be paid to the Welfare Director",
              "-",
              "-",
              "2000"
          ])

          total_cost += 2000

          def generate_pdf(path="Director_of_Welfare_Budget_Proposal.pdf"):
              styles = getSampleStyleSheet()
              title_style = styles["Title"]
              normal = styles["Normal"]

              doc = SimpleDocTemplate(path, pagesize=A4)

              elements = []

              elements.append(
                  Paragraph("<b>DIRECTOR OF WELFARE BUDGET PROPOSAL</b>", title_style)
              )
              elements.append(Spacer(1, 12))

              objective_text = (
                  "This proposal outlines the estimated monthly welfare expenses required "
                  "to support the department with essential first aid and welfare items. "
              )
              elements.append(Paragraph(objective_text, normal))
              elements.append(Spacer(1, 12))

              table_data = [
                  ["Name", "Description", "Quantity", "Unit Cost (#)", "Estimated Cost (#)"]
              ] + rows

              table = Table(table_data, repeatRows=1)
              table.setStyle(TableStyle([
                  ('BACKGROUND', (0,0), (-1,0), colors.lightgrey),
                  ('FONTNAME', (0,0), (-1,0), 'Helvetica-Bold'),
                  ('ALIGN', (0,0), (-1,-1), 'CENTER'),
                  ('GRID', (0,0), (-1,-1), 0.8, colors.grey),
                  ('BACKGROUND', (0,1), (-1,-1), colors.whitesmoke),
              ]))

              elements.append(table)
              elements.append(Spacer(1, 18))

              total_text = f"<b>Total Estimated Monthly Cost: #{total_cost}</b>"
              elements.append(Paragraph(total_text, styles["Heading2"]))

              doc.build(elements)

          generate_pdf()
          EOF

      - name: Upload PDF artifact
        uses: actions/upload-artifact@v4
        with:
          name: welfare-pdf
          path: Director_of_Welfare_Budget_Proposal.pdf
